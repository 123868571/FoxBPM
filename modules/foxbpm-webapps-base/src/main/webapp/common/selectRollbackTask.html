<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>Insert title here</title>
<link rel="stylesheet" type="text/css" href="css/index.css">
<link rel="stylesheet" type="text/css" href="css/reset.css">
<link rel="stylesheet" type="text/css" href="css/color_red.css">
<script type="text/javascript" src="js/jquery.js"></script>
<script type="text/javascript" src="js/foxbpmframework.js"></script>
<script type="text/javascript">
function applyData(){
	$.ajax({
        type: "get",//使用get方法访问后台
        dataType: "json",//返回json格式的数据
        url: "../service/task/rollbackTasks",//要访问的后台地址
        data:{taskId:_taskId},
        success: function(msg){//msg为返回的数据，在这里做数据绑定
            var data = msg.data;
            var dataTable = $("<table id='dataList' width='100%' class='fix-table'></table>");
            var dataThead = $("<thead><th style='width: 50%;'>步骤名称</th><th>处理者</th><th>处理结果</th><th>处理意见</th></thead>");
            dataThead.appendTo(dataTable);
            var dataTbody = $("<tbody></tbody>");
            //画任务命令
            $.each(data, function(i, n){
                var dataTr = $("<tr></tr>");
               	dataTr.attr("nodeId",n.nodeId);
               	dataTr.attr("rollBackAssignee",n.assignee);
                dataTr.append($("<td></td>").append(n.nodeName));
                dataTr.append($("<td></td>").append(n.assgneeUserName));
                dataTr.append($("<td></td>").append(n.commandMessage));
                dataTr.append($("<td></td>").append(n.taskComment));
                dataTbody.append(dataTr);
            });
            
            dataTable.append(dataTbody);
            $("#flowNodeList").html(dataTable);
            $("table#dataList tr").click(function() {
        		$("table#dataList tr.selected").removeClass("selected");
        		$(this).addClass("selected");
        	});
        },
        error:function(mes){
        	$("#flowNodeList").html(mes.responseText);
        }
	 });
}
$(document).ready(function() {
	applyData();
	$("#ok").click(function() {
		var rv = null;
		$("table#dataList tr.selected").each(function(index) {
			rv = {};
			var nodeId = $(this).attr("nodeId");
			var assignee = $(this).attr("rollBackAssignee");
			rv["rollBackNodeId"] = nodeId;
			rv["rollBackAssignee"] = assignee;
		});
		if (window.opener) {
			window.opener.rv = rv;
		} else if (obj.opener) {
			obj.opener.rv = rv;
		} else {
			obj.fn(obj.params, rv);
		}
		window.close();
	});
});



</script>
</head>
<body>
<div class="btn-normal">
	<a href="javascript:void(0)" id="ok">确定</a>
</div>
<div id="flowNodeList" class="content"></div>
</body>
</html>